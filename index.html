<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snapli üíï Valentine's Photobooth</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink-dark: #d63384;
            --pink-mid: #e96aa0;
            --pink-light: #f8c8dc;
            --pink-pale: #fff0f5;
            --rose: #ff6b8a;
            --blush: #ffe0ec;
            --cream: #fff8fa;
            --red-heart: #e8294a;
            --ink-color: #5c2340;
            --gold: #d4a574;
        }

        * { box-sizing: border-box; }

        body {
            background: linear-gradient(160deg, #fff0f5 0%, #fce4ec 30%, #f8bbd0 70%, #f48fb1 100%);
            color: var(--ink-color);
            font-family: 'Patrick Hand', cursive;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            min-height: 100svh;
            overflow-x: hidden;
            overflow-y: auto;
            user-select: none;
            position: relative;
        }

        /* --- Floating Hearts Background --- */
        .floating-hearts {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .floating-hearts span {
            position: absolute;
            bottom: -40px;
            font-size: 1.4rem;
            animation: floatUp linear infinite;
            opacity: 0.4;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.4; }
            50% { opacity: 0.7; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }

        /* --- Layout Containers --- */
        #app {
            width: 100%;
            max-width: 960px;
            text-align: center;
            position: relative;
            z-index: 1;
            padding: 10px 10px;
            transform: scale(0.88);
            transform-origin: top center;
        }

        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .screen.active {
            display: flex;
        }

        /* --- Hand-drawn Box Styles --- */
        .sketchy-box {
            border: 3px solid var(--pink-dark);
            padding: 20px;
            background: rgba(255,255,255,0.85);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            box-shadow: 2px 3px 12px rgba(214,51,132,0.15);
        }

        .btn {
            background: linear-gradient(135deg, var(--rose), var(--pink-dark));
            border: 2px solid var(--pink-dark);
            font-family: 'Patrick Hand', cursive;
            font-size: 1.4rem;
            padding: 10px 28px;
            cursor: pointer;
            margin-top: 16px;
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            transition: transform 0.15s, box-shadow 0.15s;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            box-shadow: 2px 3px 8px rgba(214,51,132,0.2);
        }

        .btn:hover {
            transform: scale(1.06) rotate(-1deg);
            background: linear-gradient(135deg, var(--pink-dark), #c2185b);
            box-shadow: 3px 4px 14px rgba(214,51,132,0.35);
        }

        .btn:active {
            transform: scale(0.95);
        }

        /* --- Landing Page --- */
        #screen-landing {
            gap: clamp(4px, 1vh, 10px);
            min-height: 100vh;
            min-height: 100svh;
            justify-content: center;
            box-sizing: border-box;
            padding: clamp(4px, 1vh, 10px) 0;
        }

        .valentine-header {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            color: var(--pink-dark);
            margin-bottom: -4px;
            letter-spacing: 6px;
            text-align: center;
            text-shadow: 1px 1px 4px rgba(214,51,132,0.2);
            white-space: nowrap;
            align-self: center;
        }

        .booth-shell {
            width: 100%;
            max-width: 480px;
            background: linear-gradient(180deg, #fff 0%, var(--blush) 100%);
            border: 3px solid var(--pink-dark);
            border-radius: 22px;
            box-shadow: 4px 6px 20px rgba(214,51,132,0.18);
            padding: 14px;
            position: relative;
            margin-bottom: 10px;
        }

        .booth-shell::before {
            content: "üß∏";
            position: absolute;
            bottom: -16px;
            left: 16px;
            font-size: 1.4rem;
        }

        .booth-shell::after {
            content: "üêº";
            position: absolute;
            bottom: -16px;
            right: 16px;
            font-size: 1.4rem;
        }

        .booth-sign {
            margin: 0 auto 10px;
            display: inline-block;
            padding: 6px 22px;
            border: 3px solid var(--pink-dark);
            font-family: 'Dancing Script', cursive;
            font-size: 2.2rem;
            letter-spacing: 2px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--pink-light), var(--rose));
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            position: relative;
        }

        .booth-sign::before { content: "üíï "; }
        .booth-sign::after { content: " üíï"; }

        .booth-body {
            display: flex;
            gap: 16px;
        }

        .booth-panel {
            border: 3px solid var(--pink-mid);
            border-radius: 14px;
            padding: 10px;
            flex: 1;
            min-height: clamp(180px, 28vh, 240px);
            position: relative;
            background: rgba(255,255,255,0.9);
        }

        .featured-window {
            border: 2px solid var(--pink-mid);
            padding: 6px;
            background: linear-gradient(180deg, #fff 0%, var(--pink-pale) 100%);
            margin-bottom: 8px;
            border-radius: 8px;
        }

        .featured-strips {
            display: flex;
            gap: 6px;
            justify-content: space-between;
        }

        .strip {
            width: 24px;
            height: clamp(60px, 10vh, 90px);
            border: 2px solid var(--pink-mid);
            border-radius: 4px;
            background:
                repeating-linear-gradient(
                    to bottom,
                    var(--pink-light) 0 10px,
                    #fff 10px 20px
                );
        }

        .featured-label {
            font-size: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            color: var(--pink-dark);
            font-weight: bold;
            text-align: center;
        }

        .featured-label .featured-arrow {
            font-size: 1.4rem;
            display: block;
        }

        .coin-slot {
            width: 46px;
            height: clamp(70px, 10vh, 90px);
            border: 2px solid var(--pink-mid);
            border-radius: 10px;
            margin: 8px auto 0;
            position: relative;
            background: linear-gradient(180deg, var(--pink-pale), var(--blush));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 6px 0 8px;
        }

        .coin-slot::before {
            content: "üíó";
            position: relative;
            font-size: 1.3rem;
            z-index: 3;
        }

        .coin-slot::after {
            content: "";
            width: 18px;
            height: 24px;
            border: 2px solid var(--pink-mid);
            border-radius: 6px;
            background: #fff;
            z-index: 1;
            position: relative;
        }

        /* Drop coin box */
        .drop-coin-slot {
            width: 46px;
            height: clamp(70px, 10vh, 90px);
            border: 2px solid var(--pink-mid);
            border-radius: 10px;
            margin: 8px auto 0;
            position: relative;
            background: linear-gradient(180deg, var(--pink-pale), var(--blush));
            cursor: pointer;
            transition: transform 0.15s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 6px 0 8px;
        }

        .drop-coin-slot:hover {
            transform: scale(1.05);
        }

        .drop-coin-slot::before {
            content: "ü™ô";
            position: relative;
            font-size: 1.3rem;
            z-index: 3;
        }

        .drop-coin-slot .coin-insert-area {
            width: 18px;
            height: 24px;
            border: 2px solid var(--pink-mid);
            border-radius: 6px;
            background: #fff;
            cursor: pointer;
            z-index: 1;
            position: relative;
        }

        /* Coin animation */
        .coin-anim {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.6rem;
            animation: coinDrop 0.6s ease-in forwards;
            pointer-events: none;
            z-index: 20;
        }

        @keyframes coinDrop {
            0% { top: -30px; opacity: 1; transform: translateX(-50%) rotate(0deg); }
            60% { top: 50px; opacity: 1; transform: translateX(-50%) rotate(180deg); }
            80% { top: 45px; opacity: 1; transform: translateX(-50%) rotate(270deg); }
            100% { top: 55px; opacity: 0; transform: translateX(-50%) rotate(360deg); }
        }

        .drop-coin-slot.coin-dropped::before {
            content: "‚úÖ";
        }

        /* Pay first popup */
        .pay-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #fff, var(--pink-pale));
            border: 3px solid var(--pink-dark);
            border-radius: 20px;
            padding: 30px 40px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 8px 30px rgba(214,51,132,0.3);
            transition: transform 0.3s ease;
        }

        .pay-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .pay-popup .popup-heart {
            font-size: 3rem;
            display: block;
            margin-bottom: 10px;
        }

        .pay-popup .popup-text {
            font-size: 1.6rem;
            color: var(--pink-dark);
            font-family: 'Patrick Hand', cursive;
        }

        .pay-popup-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 999;
            display: none;
        }

        .pay-popup-overlay.show {
            display: block;
        }

        .curtain {
            position: absolute;
            top: 12px;
            right: 12px;
            bottom: 12px;
            left: 12px;
            border: 2px solid var(--pink-mid);
            border-radius: 12px;
            background:
                repeating-linear-gradient(
                    to right,
                    var(--pink-light) 0 10px,
                    var(--blush) 10px 16px
                );
        }

        .enter-cta {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--rose), var(--red-heart));
            color: #fff;
            border: 2px solid var(--pink-dark);
            font-size: 1.3rem;
            padding: 8px 22px;
            border-radius: 30px;
            z-index: 2;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .enter-cta:hover {
            background: linear-gradient(135deg, var(--red-heart), #b71c1c);
            transform: translate(-50%, -50%) scale(1.06);
        }

        .stool {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 18px;
            border: 2px solid var(--pink-mid);
            border-radius: 12px;
            background: var(--pink-light);
            z-index: 1;
        }

        .stool::after {
            content: "";
            position: absolute;
            top: 16px;
            left: 50%;
            width: 10px;
            height: 28px;
            border: 2px solid var(--pink-mid);
            border-top: none;
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
            transform: translateX(-50%);
            background: var(--pink-light);
        }

        .landing-note {
            font-size: 1.1rem;
            color: var(--pink-dark);
            margin: 0;
        }

        .landing-deco {
            font-size: 1.4rem;
            letter-spacing: 6px;
            margin: 0;
        }

        /* --- Camera Page --- */
        #screen-camera h2 {
            color: var(--pink-dark);
            font-size: 1.8rem;
        }

        #screen-camera h2::before { content: "üì∏ "; }
        #screen-camera h2::after { content: " üíñ"; }

        #camera-container {
            width: 340px;
            height: 255px;
            position: relative;
            background: #000;
            overflow: hidden;
            margin-bottom: 16px;
            border-color: var(--pink-dark) !important;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        #countdown-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            color: white;
            text-shadow: 2px 2px 8px rgba(214,51,132,0.6), 0 0 20px rgba(255,255,255,0.4);
            display: none;
            font-family: 'Dancing Script', cursive;
        }

        .flash {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--pink-light);
            opacity: 0;
            pointer-events: none;
        }

        .flash.active {
            animation: flashAnim 0.25s ease-out;
        }

        @keyframes flashAnim {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* --- Stickers --- */
        .sticker-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }

        .sticker-bar .btn {
            font-size: 1rem;
            padding: 5px 13px;
            margin-top: 0;
        }

        .sticker-bar .btn.active {
            background: linear-gradient(135deg, #fff, var(--pink-light));
            color: var(--pink-dark);
            border-color: var(--red-heart);
            transform: scale(1.04);
            box-shadow: 0 0 8px rgba(232,41,74,0.3);
        }

        /* Sticker overlay on video */
        .sticker-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: hidden;
        }

        .sticker-overlay .sticker-item {
            position: absolute;
            text-align: center;
            line-height: 1;
            /* Mirror to match the mirrored video */
            transform: scaleX(-1);
        }

        /* --- Printing Page --- */
        #screen-printing h2 {
            color: var(--pink-dark);
        }
        #screen-printing h2::before { content: "üß∏ "; }
        #screen-printing h2::after { content: " üêº"; }

        #printing-slot {
            width: 140px;
            height: 20px;
            background: var(--pink-dark);
            margin: 0 auto;
            border-radius: 10px;
            position: relative;
            z-index: 10;
        }

        #strip-container {
            width: 200px;
            margin: 0 auto;
            position: relative;
            overflow: visible;
            perspective: 500px;
        }

        #photo-strip {
            width: 100%;
            box-shadow: 0 4px 12px rgba(214,51,132,0.25);
            transform-origin: top;
            transform: translateY(-100%);
            transition: transform 3s ease-out;
            will-change: transform;
        }
        
        #photo-strip.printed {
            transform: translateY(0);
        }

        /* --- Result Page --- */
        #screen-result h2 {
            color: var(--pink-dark);
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
        }
        #screen-result h2::before { content: "üíù "; }
        #screen-result h2::after { content: " üíù"; }

        .controls {
            margin-top: 24px;
            display: flex;
            gap: 20px;
            justify-content: center;
            padding-bottom: 30px;
        }

        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }

        .filter-bar .btn {
            font-size: 1rem;
            padding: 5px 13px;
            margin-top: 0;
        }

        .filter-bar .btn.active {
            background: linear-gradient(135deg, #fff, var(--pink-light));
            color: var(--pink-dark);
            border-color: var(--red-heart);
            transform: scale(1.04);
            box-shadow: 0 0 8px rgba(232,41,74,0.3);
        }

        .countdown-controls {
            margin-top: 12px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .countdown-controls .btn {
            font-size: 1.05rem;
            padding: 6px 16px;
            margin-top: 0;
        }

        .countdown-controls .btn.stop {
            background: linear-gradient(135deg, #555, #333);
            color: #fff;
            border-color: #333;
        }

        .countdown-controls .btn.stop:hover {
            background: linear-gradient(135deg, #333, #111);
        }

        .photo-count {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            color: var(--pink-dark);
            font-size: 1.1rem;
        }

        .photo-count input {
            width: 70px;
            padding: 6px 8px;
            font-size: 1rem;
            border: 2px solid var(--pink-mid);
            border-radius: 10px;
            font-family: 'Patrick Hand', cursive;
            text-align: center;
            background: var(--pink-pale);
            color: var(--ink-color);
        }

        .photo-count input:focus {
            outline: none;
            border-color: var(--red-heart);
            box-shadow: 0 0 6px rgba(232,41,74,0.3);
        }

        /* Arrows and scribbles */
        .doodle-arrow {
            font-size: 1.5rem;
            margin-bottom: 4px;
            align-self: center;
            color: var(--pink-dark);
        }

        .layout-options {
            display: flex;
            gap: 20px;
            margin-top: 14px;
            width: 100%;
            justify-content: center;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .layout-card {
            border: 2px dashed var(--pink-mid);
            padding: 12px;
            background: rgba(255,255,255,0.9);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            flex: 0 1 auto;
            max-width: 280px;
            box-shadow: 2px 3px 12px rgba(214,51,132,0.1);
        }

        .layout-card img {
            width: 100%;
            max-height: 55vh;
            object-fit: contain;
            box-shadow: 2px 3px 10px rgba(214,51,132,0.15);
            border-radius: 8px;
        }

        .layout-card .btn {
            font-size: 1rem;
            padding: 6px 14px;
            margin-top: 0;
        }

        /* --- Section Labels --- */
        .section-label {
            font-size: 1.05rem;
            color: var(--pink-dark);
            margin-top: 4px;
            margin-bottom: 2px;
            font-weight: bold;
        }

        #status-text {
            color: var(--pink-dark);
            font-size: 1.15rem;
        }

        /* Corner decorations removed to avoid overlap with content */

        /* === ENVELOPE SCREEN (inside #app, compensates for scale) === */
        #screen-envelope {
            align-items: center;
            padding-top: calc(45vh / 0.88);
            padding-bottom: 40px;
        }

        .envelope-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        /* The envelope visual */
        .envelope-scene {
            position: relative;
            width: 320px;
            height: 160px;
            cursor: pointer;
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .envelope-scene.vanish {
            opacity: 0;
            transform: scale(0.6);
            pointer-events: none;
        }

        .envelope-hint {
            font-family: 'Dancing Script', cursive;
            font-size: 1.4rem;
            color: var(--pink-dark);
            animation: hintPulse 2s ease-in-out infinite;
            transition: opacity 0.4s ease;
        }

        @keyframes hintPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Envelope body (main rectangle) */
        .envelope-body {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 160px;
            background: linear-gradient(180deg, #f5e6d3 0%, #ece0d1 100%);
            border: 3px solid #6b5b4f;
            border-radius: 4px 4px 10px 10px;
            z-index: 10;
            overflow: hidden;
        }

        /* X-shape lines on envelope front */
        .envelope-body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                linear-gradient(to bottom right, transparent 49.5%, #9b8b7a 49.5%, #9b8b7a 50.5%, transparent 50.5%),
                linear-gradient(to bottom left, transparent 49.5%, #9b8b7a 49.5%, #9b8b7a 50.5%, transparent 50.5%);
            opacity: 0.3;
        }

        /* Heart seal - centered on envelope body */
        .envelope-heart {
            position: absolute;
            bottom: 55px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.8rem;
            z-index: 15;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            transition: transform 0.4s ease, opacity 0.4s ease;
        }

        .envelope-scene:hover .envelope-heart {
            transform: translateX(-50%) scale(1.15);
        }

        /* === Message card (centered, hidden by default) === */
        .message-card {
            opacity: 0;
            transform: scale(0.7);
            pointer-events: none;
            transition: opacity 0.7s ease, transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: #fff;
            border: 3px solid var(--pink-mid);
            border-radius: 18px;
            padding: clamp(16px, 3vh, 36px) 28px clamp(14px, 2vh, 28px);
            text-align: center;
            box-shadow: 0 8px 40px rgba(214,51,132,0.2);
            max-width: 360px;
            width: 90%;
        }

        .message-card.visible {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .message-card .letter-text {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(1.4rem, 3.5vw, 2.2rem);
            color: var(--pink-dark);
            line-height: 1.3;
        }

        .message-card .letter-hearts {
            font-size: 1.4rem;
            margin-top: 8px;
        }

        /* Snap button after letter */
        .snap-btn-wrapper {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
            pointer-events: none;
            margin-top: 12px;
        }

        .snap-btn-wrapper.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .snap-btn-wrapper .btn {
            font-size: 1.3rem;
            padding: 10px 28px;
            background: linear-gradient(135deg, var(--rose), var(--red-heart));
            border-radius: 30px;
            letter-spacing: 1px;
        }

        .snap-btn-wrapper .btn:hover {
            background: linear-gradient(135deg, var(--red-heart), #b71c1c);
        }
    </style>
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
</head>
<body>

<!-- Floating Hearts Background -->
<div class="floating-hearts" id="floating-hearts"></div>


<div id="app">

    <!-- ENVELOPE SCREEN -->
    <div id="screen-envelope" class="screen active">
        <div class="envelope-wrapper">
            <!-- Envelope (disappears on click) -->
            <div class="envelope-scene" id="envelope-scene" onclick="openEnvelope()">
                <div class="envelope-body"></div>
                <div class="envelope-heart">üíó</div>
            </div>
            <div class="envelope-hint" id="envelope-hint">tap the envelope üíå</div>

            <!-- Message card (appears after envelope disappears) -->
            <div class="message-card" id="message-card">
                <div class="letter-text">
                    Happy Valentines Day!‚ù§Ô∏è<br>
                    Let's make some memoriesüòä
                </div>
                <div class="letter-hearts">üíïüß∏üíóüêºüíï</div>
            </div>
            <div class="snap-btn-wrapper" id="snap-btn-wrapper">
                <button class="btn" onclick="goToPhotobooth()">üì∏ Let's snap some pics!</button>
            </div>
        </div>
    </div>

    <div id="screen-landing" class="screen">
        <div class="valentine-header">üíï Happy Valentine's Day üíï</div>
        <div class="booth-shell">
            <div class="booth-sign">Snapli</div>
            <div class="booth-body">
                <div class="booth-panel">
                    <div class="featured-window">
                        <div class="featured-strips">
                            <div class="strip"></div>
                            <div class="strip"></div>
                            <div class="strip"></div>
                            <div class="strip"></div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 16px; justify-content: center; align-items: flex-start;">
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div class="featured-label"><span>Get your snaps</span><span class="featured-arrow">‚Üì</span></div>
                            <div class="coin-slot"></div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div class="featured-label"><span>Drop coin</span><span class="featured-arrow">‚Üì</span></div>
                            <div class="drop-coin-slot" id="drop-coin-slot" onclick="dropCoin()">
                                <div class="coin-insert-area"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="booth-panel">
                    <div class="curtain"></div>
                    <button class="btn enter-cta" onclick="tryEnter()">Enter ‚Üí</button>
                    <div class="stool"></div>
                </div>
            </div>
        </div>
        <div class="landing-deco">üß∏ üíï üêº üíï üß∏</div>
        <div class="landing-note">Take photos. Get a collage. Share the love üíó</div>
    </div>

    <div id="screen-camera" class="screen">
        <h2>Strike a Pose!</h2>
        <div id="camera-container" class="sketchy-box">
            <video id="video" autoplay playsinline></video>
            <div class="sticker-overlay" id="sticker-overlay"></div>
            <div id="countdown-overlay">3</div>
            <div class="flash" id="flash"></div>
        </div>
        <p id="status-text">Pick a filter, then start üíñ</p>
        <div class="section-label">üé® Filters</div>
        <div class="filter-bar" id="filter-bar">
            <button class="btn active" data-filter="none">No Filter</button>
            <button class="btn" data-filter="bw">B&W</button>
            <button class="btn" data-filter="sepia">Sepia</button>
            <button class="btn" data-filter="vintage">Vintage</button>
            <button class="btn" data-filter="rosy">Rosy üíï</button>
            <button class="btn" data-filter="cool">Cool Blue</button>
            <button class="btn" data-filter="golden">Golden</button>
            <button class="btn" data-filter="soft">Soft Glow</button>
            <button class="btn" data-filter="dramatic">Dramatic</button>
            <button class="btn" data-filter="fade">Fade</button>
            <button class="btn" data-filter="vivid">Vivid</button>
        </div>
        <div class="section-label" style="margin-top:10px;">üé≠ Stickers</div>
        <div class="sticker-bar" id="sticker-bar">
            <button class="btn active" data-sticker="none">None</button>
            <button class="btn" data-sticker="bunny-ears">üê∞ Bunny</button>
            <button class="btn" data-sticker="cat-ears">üê± Cat</button>
            <button class="btn" data-sticker="crown">üëë Crown</button>
            <button class="btn" data-sticker="cowboy">ü§† Cowboy</button>
            <button class="btn" data-sticker="top-hat">üé© Top Hat</button>
            <button class="btn" data-sticker="sunglasses">üï∂Ô∏è Shades</button>
            <button class="btn" data-sticker="heart-eyes">üòç Hearts</button>
            <button class="btn" data-sticker="star-glasses">‚≠ê Stars</button>
            <button class="btn" data-sticker="bow">üéÄ Bow</button>
        </div>
        <div class="section-label" style="margin-top:10px;">‚è±Ô∏è Countdown</div>
        <div class="countdown-controls" id="countdown-controls">
            <button class="btn" data-countdown="10">10s</button>
            <button class="btn" data-countdown="5">5s</button>
            <button class="btn" data-countdown="3">3s</button>
            <button class="btn stop" data-action="stop">‚èπ Stop</button>
        </div>
        <div class="photo-count">
            <label for="photo-count-input">üíï Photos:</label>
            <input id="photo-count-input" type="number" min="1" max="20" value="4">
        </div>
    </div>

    <div id="screen-printing" class="screen">
        <h2>Developing your love snaps...</h2>
        <div style="margin-top: 50px;">
            <div id="printing-slot"></div>
            <div id="strip-container">
                <img id="photo-strip" src="" alt="Your photo strip">
            </div>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <h2>Your Snaps!</h2>
        <div class="doodle-arrow">‚Üì it's you! üíó</div>
        
        <div class="layout-options" id="layout-options"></div>
        <div class="controls">
            <button class="btn" onclick="resetApp()">üîÑ Restart</button>
        </div>
    </div>

</div>

<!-- Pay first popup -->
<div class="pay-popup-overlay" id="pay-popup-overlay" onclick="hidePayPopup()"></div>
<div class="pay-popup" id="pay-popup">
    <span class="popup-heart">üíó</span>
    <span class="popup-text">Please pay first!</span>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
    // --- Coin Drop & Enter Gate ---
    let coinDropped = false;

    function dropCoin() {
        if (coinDropped) return;
        const slot = document.getElementById('drop-coin-slot');
        // Create coin animation element
        const coin = document.createElement('span');
        coin.className = 'coin-anim';
        coin.textContent = 'ü™ô';
        slot.appendChild(coin);
        // After animation, mark as dropped
        setTimeout(() => {
            coin.remove();
            slot.classList.add('coin-dropped');
            coinDropped = true;
        }, 650);
    }

    function tryEnter() {
        if (!coinDropped) {
            showPayPopup();
            return;
        }
        startBooth();
    }

    function showPayPopup() {
        document.getElementById('pay-popup-overlay').classList.add('show');
        document.getElementById('pay-popup').classList.add('show');
        // Auto-hide after 2 seconds
        setTimeout(hidePayPopup, 2000);
    }

    function hidePayPopup() {
        document.getElementById('pay-popup-overlay').classList.remove('show');
        document.getElementById('pay-popup').classList.remove('show');
    }

    // --- Floating Hearts ---
    (function createFloatingHearts() {
        const container = document.getElementById('floating-hearts');
        const emojis = ['üíï', '‚ù§Ô∏è', 'üíó', 'üíñ', 'ü©∑', 'üíò', 'üß∏', 'üêº', '‚ô•', 'üíù'];
        for (let i = 0; i < 25; i++) {
            const span = document.createElement('span');
            span.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            span.style.left = Math.random() * 100 + '%';
            span.style.fontSize = (0.8 + Math.random() * 1.2) + 'rem';
            span.style.animationDuration = (8 + Math.random() * 14) + 's';
            span.style.animationDelay = (Math.random() * 12) + 's';
            container.appendChild(span);
        }
    })();

    // --- Envelope Logic ---
    let envelopeOpened = false;

    function openEnvelope() {
        if (envelopeOpened) return;
        envelopeOpened = true;
        const scene = document.getElementById('envelope-scene');
        const hint = document.getElementById('envelope-hint');

        // Make envelope disappear
        scene.classList.add('vanish');
        hint.style.opacity = '0';

        // After envelope fades out, show message card in center
        setTimeout(() => {
            scene.style.display = 'none';
            hint.style.display = 'none';
            // Reduce padding so message + button fit on screen
            document.getElementById('screen-envelope').style.paddingTop = 'calc(20vh / 0.88)';
            document.getElementById('message-card').classList.add('visible');
        }, 650);

        // Show the "Let's snap some pics!" button after message appears
        setTimeout(() => {
            document.getElementById('snap-btn-wrapper').classList.add('visible');
        }, 1300);
    }

    function goToPhotobooth() {
        showScreen('landing');
    }

    // --- Configuration ---
    const DEFAULT_COUNTDOWN_SECONDS = 5;
    const STRIP_WIDTH = 300;
    const SINGLE_PHOTO_HEIGHT = 300;

    // --- State ---
    let photos = [];
    let stream = null;

    // --- Elements ---
    const screens = {
        envelope: document.getElementById('screen-envelope'),
        landing: document.getElementById('screen-landing'),
        camera: document.getElementById('screen-camera'),
        printing: document.getElementById('screen-printing'),
        result: document.getElementById('screen-result')
    };
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const countdownEl = document.getElementById('countdown-overlay');
    const statusText = document.getElementById('status-text');
    const flash = document.getElementById('flash');
    const stripImg = document.getElementById('photo-strip');
    const filterBar = document.getElementById('filter-bar');
    const stickerBar = document.getElementById('sticker-bar');
    const stickerOverlay = document.getElementById('sticker-overlay');
    const countdownControls = document.getElementById('countdown-controls');
    const photoCountInput = document.getElementById('photo-count-input');
    const layoutOptions = document.getElementById('layout-options');

    // --- Navigation ---
    function showScreen(name) {
        Object.values(screens).forEach(s => s.classList.remove('active'));
        screens[name].classList.add('active');
        // Scroll to top when switching screens
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // --- Filters ---
    const FILTERS = {
        none: 'none',
        bw: 'grayscale(100%) contrast(1.3)',
        sepia: 'sepia(75%) contrast(1.1) brightness(1.05)',
        vintage: 'sepia(35%) saturate(75%) contrast(1.15) brightness(0.95)',
        rosy: 'saturate(130%) hue-rotate(330deg) brightness(1.05) contrast(1.05)',
        cool: 'saturate(90%) hue-rotate(15deg) brightness(1.05) contrast(1.1)',
        golden: 'sepia(25%) saturate(140%) brightness(1.1) contrast(1.05)',
        soft: 'brightness(1.15) contrast(0.88) saturate(110%) blur(0.5px)',
        dramatic: 'contrast(1.55) saturate(120%) brightness(0.92)',
        fade: 'brightness(1.15) contrast(0.8) saturate(70%)',
        vivid: 'saturate(180%) contrast(1.15) brightness(1.02)'
    };
    let activeFilter = 'none';
    let selectedCountdownSeconds = DEFAULT_COUNTDOWN_SECONDS;
    let selectedPhotoCount = Number(photoCountInput.value) || 4;
    let isCapturing = false;
    let isCountdownActive = false;
    let countdownTimer = null;
    let countdownResolve = null;

    function applyFilter(filterKey) {
        activeFilter = filterKey;
        video.style.filter = FILTERS[filterKey] || 'none';
    }

    filterBar.addEventListener('click', (event) => {
        const btn = event.target.closest('button[data-filter]');
        if (!btn) return;
        filterBar.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applyFilter(btn.dataset.filter);
    });

    // --- Stickers ---
    // Each sticker has items: array of { emoji, fontSize (% of container), top (%), left (%) }
    const STICKERS = {
        'none': [],
        'bunny-ears': [
            { emoji: 'üê∞', fontSize: 35, top: 5, left: 10 },
            { emoji: 'üê∞', fontSize: 35, top: 5, left: 62 }
        ],
        'cat-ears': [
            { emoji: 'üò∫', fontSize: 28, top: 6, left: 10 },
            { emoji: 'üò∫', fontSize: 28, top: 6, left: 68 }
        ],
        'crown': [
            { emoji: 'üëë', fontSize: 32, top: -6, left: 37 }
        ],
        'cowboy': [
            { emoji: 'ü§†', fontSize: 28, top: 2, left: 68 }
        ],
        'top-hat': [
            { emoji: 'üé©', fontSize: 32, top: 2, left: 37 }
        ],
        'sunglasses': [
            { emoji: 'üï∂Ô∏è', fontSize: 30, top: 28, left: 35 }
        ],
        'heart-eyes': [
            { emoji: '‚ù§Ô∏è', fontSize: 16, top: 30, left: 30 },
            { emoji: '‚ù§Ô∏è', fontSize: 16, top: 30, left: 55 }
        ],
        'star-glasses': [
            { emoji: '‚≠ê', fontSize: 18, top: 4, left: 8 },
            { emoji: '‚≠ê', fontSize: 18, top: 4, left: 68 }
        ],
        'bow': [
            { emoji: 'üéÄ', fontSize: 28, top: -4, left: 38 }
        ]
    };
    let activeSticker = 'none';

    function applySticker(stickerKey) {
        activeSticker = stickerKey;
        stickerOverlay.innerHTML = '';
        const items = STICKERS[stickerKey] || [];
        items.forEach(item => {
            const el = document.createElement('span');
            el.className = 'sticker-item';
            el.textContent = item.emoji;
            el.style.fontSize = (item.fontSize / 100 * 255) + 'px'; // relative to container height
            el.style.top = item.top + '%';
            el.style.left = item.left + '%';
            stickerOverlay.appendChild(el);
        });
    }

    stickerBar.addEventListener('click', (event) => {
        const btn = event.target.closest('button[data-sticker]');
        if (!btn) return;
        stickerBar.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applySticker(btn.dataset.sticker);
    });

    countdownControls.addEventListener('click', (event) => {
        const btn = event.target.closest('button[data-countdown]');
        const stopBtn = event.target.closest('button[data-action="stop"]');
        if (stopBtn) {
            stopCountdown();
            return;
        }
        if (!btn || isCapturing || isCountdownActive) return;
        selectedCountdownSeconds = Number(btn.dataset.countdown);
        startCaptureSequence();
    });

    photoCountInput.addEventListener('change', () => {
        const value = Math.max(1, Math.min(20, Number(photoCountInput.value) || 1));
        photoCountInput.value = value;
        selectedPhotoCount = value;
    });

    // --- Step 1: Start Booth ---
    async function startBooth() {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "user", width: { ideal: 1280 }, height: { ideal: 720 } }, 
                audio: false 
            });
            video.srcObject = stream;
            showScreen('camera');
            photos = [];
            applyFilter(activeFilter);
            statusText.innerText = "Pick a filter, then start üíñ";
        } catch (err) {
            alert("Please allow camera access to use the photobooth! üì∏");
            console.error(err);
        }
    }

    // --- Step 2: Capture Logic ---
    async function startCaptureSequence() {
        if (!stream || isCapturing) return;
        isCapturing = true;
        for (let i = 1; i <= selectedPhotoCount; i++) {
            statusText.innerText = `üíó Photo ${i} of ${selectedPhotoCount}`;
            const ok = await runCountdown(selectedCountdownSeconds);
            if (!ok) {
                isCapturing = false;
                statusText.innerText = "Paused üí§ Choose a countdown to resume.";
                return;
            }
            snapPhoto();
            await new Promise(r => setTimeout(r, 1000));
        }
        finishCapture();
    }

    function runCountdown(seconds) {
        return new Promise(resolve => {
            let count = seconds;
            countdownEl.style.display = 'block';
            countdownEl.innerText = count;
            isCountdownActive = true;
            countdownResolve = resolve;
            countdownTimer = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.innerText = count;
                } else {
                    clearInterval(countdownTimer);
                    countdownTimer = null;
                    countdownEl.style.display = 'none';
                    isCountdownActive = false;
                    countdownResolve = null;
                    resolve(true);
                }
            }, 1000);
        });
    }

    function stopCountdown() {
        if (!isCountdownActive) return;
        clearInterval(countdownTimer);
        countdownTimer = null;
        isCountdownActive = false;
        countdownEl.style.display = 'none';
        if (countdownResolve) {
            const resolve = countdownResolve;
            countdownResolve = null;
            resolve(false);
        }
        statusText.innerText = "Countdown stopped üí§ Choose a timer to restart.";
    }

    function snapPhoto() {
        flash.classList.add('active');
        setTimeout(() => flash.classList.remove('active'), 250);

        const size = Math.min(video.videoWidth, video.videoHeight);
        const startX = (video.videoWidth - size) / 2;
        const startY = (video.videoHeight - size) / 2;

        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = STRIP_WIDTH;
        tempCanvas.height = SINGLE_PHOTO_HEIGHT;
        const tempCtx = tempCanvas.getContext('2d');

        // Draw mirrored video
        tempCtx.translate(STRIP_WIDTH, 0);
        tempCtx.scale(-1, 1);
        tempCtx.filter = FILTERS[activeFilter] || 'none';
        tempCtx.drawImage(video, startX, startY, size, size, 0, 0, STRIP_WIDTH, SINGLE_PHOTO_HEIGHT);

        // Reset transform for stickers
        tempCtx.setTransform(1, 0, 0, 1, 0, 0);
        tempCtx.filter = 'none';

        // Draw stickers onto captured photo
        const stickerItems = STICKERS[activeSticker] || [];
        stickerItems.forEach(item => {
            const fSize = (item.fontSize / 100) * SINGLE_PHOTO_HEIGHT;
            const x = (item.left / 100) * STRIP_WIDTH;
            const y = (item.top / 100) * SINGLE_PHOTO_HEIGHT;
            tempCtx.font = fSize + 'px serif';
            tempCtx.textAlign = 'left';
            tempCtx.textBaseline = 'top';
            tempCtx.fillText(item.emoji, x, y);
        });

        photos.push(tempCanvas);
    }

    // --- Step 3: Process & Print ---
    function finishCapture() {
        stream.getTracks().forEach(track => track.stop());
        isCapturing = false;
        
        generateLayouts();
        showScreen('printing');

        // Wait for image to fully load before triggering animation
        function triggerPrint() {
            stripImg.classList.remove('printed');
            // Force browser reflow
            void stripImg.offsetHeight;
            // Small delay then slide
            requestAnimationFrame(() => {
                stripImg.classList.add('printed');
            });
            // Move to final result after animation completes
            setTimeout(() => {
                showScreen('result');
            }, 3600);
        }

        if (stripImg.complete && stripImg.naturalHeight > 0) {
            triggerPrint();
        } else {
            stripImg.onload = triggerPrint;
        }
    }

    function formatDate() {
        const d = new Date();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        const yyyy = d.getFullYear();
        return `${mm}.${dd}.${yyyy}`;
    }

    function generateStrip() {
        const padding = 20;
        const headerHeight = 80;
        const footerHeight = 60;
        const totalHeight = (SINGLE_PHOTO_HEIGHT * photos.length) + (padding * (photos.length + 1)) + headerHeight + footerHeight;
        
        canvas.width = STRIP_WIDTH + (padding * 2);
        canvas.height = totalHeight;

        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = '#d63384';
        ctx.font = 'bold 36px Patrick Hand';
        ctx.textAlign = 'center';
        ctx.fillText('üíï Snapli üíï', canvas.width / 2, 52);

        let currentY = headerHeight + padding;
        photos.forEach(photoCanvas => {
            ctx.fillStyle = '#d63384';
            ctx.fillRect(padding - 2, currentY - 2, STRIP_WIDTH + 4, SINGLE_PHOTO_HEIGHT + 4);
            ctx.drawImage(photoCanvas, padding, currentY, STRIP_WIDTH, SINGLE_PHOTO_HEIGHT);
            currentY += SINGLE_PHOTO_HEIGHT + padding;
        });

        ctx.fillStyle = '#d63384';
        ctx.font = '26px Patrick Hand';
        ctx.fillText(formatDate(), canvas.width / 2, totalHeight - 22);

        return canvas.toDataURL('image/png');
    }

    // --- Step 4: Download & Reset ---
    function downloadStrip(dataUrl, label) {
        const link = document.createElement('a');
        const safeLabel = label ? label.toLowerCase().replace(/\s+/g, '-') : 'collage';
        link.download = `snapli-${safeLabel}-${Date.now()}.png`;
        link.href = dataUrl;
        link.click();
    }

    function resetApp() {
        stripImg.classList.remove('printed');
        stripImg.onload = null;
        // Reset coin state
        coinDropped = false;
        const slot = document.getElementById('drop-coin-slot');
        if (slot) slot.classList.remove('coin-dropped');
        // Go back to photobooth landing (not envelope)
        showScreen('landing');
    }

    function generateLayouts() {
        layoutOptions.innerHTML = '';
        const layouts = [
            { name: 'Strip', columns: 1, photoSize: 260 },
            { name: 'Grid 2x', columns: 2, photoSize: 200 },
            { name: 'Grid 3x', columns: 3, photoSize: 160 }
        ];

        const layoutData = layouts.map(layout => {
            const dataUrl = generateGridLayout(layout);
            return { name: layout.name, dataUrl };
        });

        stripImg.src = layoutData[0].dataUrl;

        layoutData.forEach(layout => {
            const card = document.createElement('div');
            card.className = 'layout-card';
            const img = document.createElement('img');
            img.src = layout.dataUrl;
            img.alt = `${layout.name} layout`;
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.innerText = `üíæ Download ${layout.name}`;
            btn.addEventListener('click', () => downloadStrip(layout.dataUrl, layout.name));
            card.appendChild(img);
            card.appendChild(btn);
            layoutOptions.appendChild(card);
        });
    }

    function generateGridLayout({ columns, photoSize, name }) {
        const padding = 16;
        const headerHeight = 70;
        const footerHeight = 50;
        const rows = Math.ceil(photos.length / columns);
        const totalWidth = (columns * photoSize) + (padding * (columns + 1));
        const totalHeight = (rows * photoSize) + (padding * (rows + 1)) + headerHeight + footerHeight;

        const layoutCanvas = document.createElement('canvas');
        const layoutCtx = layoutCanvas.getContext('2d');
        layoutCanvas.width = totalWidth;
        layoutCanvas.height = totalHeight;

        layoutCtx.fillStyle = '#ffffff';
        layoutCtx.fillRect(0, 0, totalWidth, totalHeight);

        layoutCtx.fillStyle = '#d63384';
        layoutCtx.font = 'bold 32px Patrick Hand';
        layoutCtx.textAlign = 'center';
        layoutCtx.fillText('üíï Snapli üíï', totalWidth / 2, 44);

        let idx = 0;
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < columns; c++) {
                if (idx >= photos.length) break;
                const x = padding + c * (photoSize + padding);
                const y = headerHeight + padding + r * (photoSize + padding);
                layoutCtx.fillStyle = '#d63384';
                layoutCtx.fillRect(x - 2, y - 2, photoSize + 4, photoSize + 4);
                layoutCtx.drawImage(photos[idx], x, y, photoSize, photoSize);
                idx++;
            }
        }

        layoutCtx.fillStyle = '#d63384';
        layoutCtx.font = '24px Patrick Hand';
        layoutCtx.fillText(formatDate(), totalWidth / 2, totalHeight - 16);

        return layoutCanvas.toDataURL('image/png');
    }

</script>
</body>
</html>
